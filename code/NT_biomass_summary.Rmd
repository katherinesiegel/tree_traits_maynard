---
title: "NT_biomass_summary"
output: html_document
date: "2024-07-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r cars}
summary(cars)
```



```{r pressure, echo=FALSE}
plot(pressure)
```


### sum of biomass for each nfi plot (ltp)
```{r}
### open large tree plot tree file
NT_ltp_tree <- read.csv("C:/Users/krist/Downloads/CGCS KH/relevant_time_data/nt_gp_ltp_tree.csv")

names(NT_ltp_tree)

### select only relevant data columns
NT_ltp_biomass <- select(NT_ltp_tree, nfi_plot, meas_date, meas_num, biomass_total)

### replace NA values as 0
NT_ltp_biomass[is.na(NT_ltp_biomass)] <- 0

### biomass sums grouped by nfi plot and meas_date
NT_ltp_biomass_sum <- NT_ltp_biomass %>%
  group_by(nfi_plot, meas_date) %>%
  summarise(biomass_total =sum(biomass_total))

```

### merge biomass and resurveyed files (ltp)
```{r}
names(NT_ltp_biomass_sum)
names(NT_ltp_resurveyed)

### check similarities between file headers
intersect(names(NT_ltp_biomass_sum), names(NT_ltp_resurveyed))

### merge files based on nfi plot and meas_date
NT_ltp_biomass_merged <- merge(NT_ltp_biomass_sum, NT_ltp_resurveyed) %>%
  mutate(percent / 100) %>%
  mutate(percent/100 * biomass_total)

### save as csv
write.csv(NT_ltp_biomass_merged, "NT_ltp_biomass_merged.csv")

```

### introducing diversity, evenness, and richness indexes (ltp)
```{r}
NT_ltp_header <- read.csv("C:/Users/krist/Downloads/CGCS KH/relevant_time_data/nt_gp_ltp_header.csv")

### select only relevant columns
names(NT_ltp_header)

NT_ltp_index <- select(NT_ltp_header, nfi_plot, meas_date, meas_num, bindex_ltshannon, bindex_lteven, bindex_ltmargalef)

### replace NA values as 0
NT_ltp_index[is.na(NT_ltp_index)] <- 0
```

### sum of biomass for each nfi plot (stp)
```{r}
### open stp tree files
NT_stp_tree <- read.csv("C:/Users/krist/Downloads/CGCS KH/relevant_time_data/nt_gp_stp_tree.csv")

names(NT_stp_tree)

### select relevant data columns
NT_stp_biomass <- select(NT_stp_tree, nfi_plot, meas_date, smtree_biomass)

### biomass sums grouped by nfi plot and meas_date
NT_stp_biomass_sum <- NT_stp_biomass %>%
  group_by(nfi_plot, meas_date) %>%
  summarise(smtree_biomass =sum(smtree_biomass))

```

### merge biomass summary and resurveyed files
```{r}
names(NT_stp_resurveyed)
names(NT_stp_biomass_sum)

### check similarities between file headers
intersect(names(NT_stp_resurveyed), names(NT_stp_biomass_sum))

### merge files based on nfi plot and meas_date
NT_stp_biomass_merged <- merge(NT_stp_biomass_sum, NT_stp_resurveyed) %>%
  mutate(smtree_percent / 100) %>%
  mutate(smtree_percent/100 * smtree_biomass)

### save as csv
write.csv(NT_stp_biomass_merged, "NT_stp_biomass_merged.csv")
```

### introducing diversity, evenness, and richness indexes (stp)
```{r}
NT_stp_header <- read.csv("C:/Users/krist/Downloads/CGCS KH/relevant_time_data/nt_gp_stp_header.csv")

### select relevant columns
names(NT_stp_header)

NT_stp_index <- select(NT_stp_header, nfi_plot, meas_date, meas_num, bindex_stshannon, bindex_steven, bindex_stmargalef)

### replace NA with 0
NT_stp_index[is.na(NT_stp_index)] <- 0
```

### merge index files
```{r}
NT_indeces <- merge(NT_ltp_index, NT_stp_index)

write.csv(NT_indeces, "NT_indeces.csv")

```